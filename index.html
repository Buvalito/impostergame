<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Imposter - The Party Game" />
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="./Logo.png">
  <link rel="icon" type="image/x-icon" href="./Logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jersey+15&display=swap" rel="stylesheet">
  <title>Imposter - The Party Game</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body, #root { height: 100%; background: #111; }
    body { overscroll-behavior: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const INITIAL_PROMPTS = [
      "Wie zou het meest waarschijnlijk beroemd worden op social media?",
      "Wie zou het meest waarschijnlijk overleven op een onbewoond eiland?",
      "Wie zou het meest waarschijnlijk per ongeluk iets in brand steken terwijl hij/zij kookt?",
      "Wie zou het meest waarschijnlijk een geheime dubbele identiteit hebben?",
      "Wie zou het meest waarschijnlijk met een vreemde op vakantie gaan?",
      "Wie zou het meest waarschijnlijk een boek schrijven?",
      "Wie zou het meest waarschijnlijk miljonair worden?",
      "Wie zou het meest waarschijnlijk in het buitenland gaan wonen?",
      "Wie zou het meest waarschijnlijk een uitvinding maken die de wereld verandert?",
      "Wie zou het meest waarschijnlijk een taal leren in 3 maanden?",
      "Wie zou het meest waarschijnlijk een extreme sport proberen?",
      "Wie zou het meest waarschijnlijk meedoen aan De Mol?",
      "Wie zou het meest waarschijnlijk uit een reality show worden gegooid in de eerste aflevering?",
      "Wie zou het meest waarschijnlijk per ongeluk een gÃªnante foto online zetten?",
      "Wie zou het meest waarschijnlijk verdwalen in een eigen stad?",
      "Wie zou het meest waarschijnlijk elke avond takeaway bestellen?",
      "Wie zou het meest waarschijnlijk zijn eigen verjaardag vergeten?",
      "Wie zou het meest waarschijnlijk een boek kopen maar nooit lezen?",
      "Wie zou het meest waarschijnlijk zijn loon uitgeven op de eerste dag?",
      "Wie zou het meest waarschijnlijk heimwee krijgen na Ã©Ã©n nacht weg van huis?",
      "Wie zou het meest waarschijnlijk boos worden als iemand zijn eten aanraakt?",
      "Wie zou het meest waarschijnlijk een hele ruzie beginnen in de groepschat en daarna 'ik ga hier niet eens op reageren' zeggen?",
      "Wie zou het meest waarschijnlijk 3 uur scrollen en dan zeggen dat hij/zij geen tijd had?",
      "Wie zou het meest waarschijnlijk een conspiracy theorie nÃ©t iets te serieus nemen?",
      "Wie zou het meest waarschijnlijk per ongeluk een voice memo van 4 minuten sturen?",
      "Wie zou het meest waarschijnlijk doen alsof hij/zij een serie al heeft gezien om niet achter te lopen?",
      "Wie zou het meest waarschijnlijk 47 tabbladen open hebben staan?",
      "Wie zou het meest waarschijnlijk een powerbank meenemen naar een festival en hem zelf vergeten op te laden?",
      "Wie zou het meest waarschijnlijk zijn/haar wachtwoord resetten en het nieuwe meteen weer vergeten?",
      "Wie zou het meest waarschijnlijk een meme uitleggen waardoor het niet meer grappig is?",
      "Wie zou het meest waarschijnlijk per ongeluk 'reply all' doen?",
      "Wie zou het meest waarschijnlijk een airfryer kopen en daarna alles erin gooien?",
      "Wie zou het meest waarschijnlijk een huisdier nemen en het een veel te menselijke naam geven?",
      "Wie zou het meest waarschijnlijk 1 aflevering kijken en eindigen om 04:00 's nachts?",
      "Wie zou het meest waarschijnlijk een impulsieve tattoo laten zetten?",
      "Wie zou het meest waarschijnlijk een online discussie winnenâ€¦ in zijn/haar hoofd onder de douche?",
      "Wie zou het meest waarschijnlijk per ongeluk een screenshot terugsturen naar de persoon waar het over ging?",
      "Wie zou het meest waarschijnlijk 'onderweg' sturen terwijl hij/zij nog thuis in de zetel zit?",
      "Wie zou het meest waarschijnlijk een nieuwe hobby beginnen en na 2 weken weer stoppen?",
      "Wie zou het meest waarschijnlijk huilen van het lachen om zijn/haar eigen grap?",
      "Wie zou het meest waarschijnlijk een pakketje bestellen en elke 10 minuten de track & trace checken?",
      "Wie zou het meest waarschijnlijk een hele maaltijd plannen rond Ã©Ã©n kortingsactie?",
      "Wie zou het meest waarschijnlijk kaka doen in zijn/haar broek tijdens het uitgaan?",
      "Wie zou het meest waarschijnlijk een kleuter schoppen?",
      "Wie zou het meest waarschijnlijk z'n huisdier vermoorden voor 1 miljoen?",
      "Wie zou het meest waarschijnlijk kip eten die over datum is?",
      "Wie zou het meest waarschijnlijk een scheet laten en het op iemand anders steken?",
      "Wie zou het meest waarschijnlijk eerst sterven?",
      "Wie zou het meest waarschijnlijk plastische chirurgie laten doen?",
      "Wie zou het meest waarschijnlijk ontslag nemen zonder al een nieuwe job te hebben?",
      "Wie zou het meest waarschijnlijk toestemming moeten vragen aan z'n partner om te gamen?",
      "Wie zou het meest waarschijnlijk een Excel-sheet maken voor iets totaal onnodigs?"
    ];

    const PHASES = {
      SETUP:           "setup",
      QUESTION_TURN:   "question_turn",
      SHOW_QUESTION:   "show_question",
      WRITE:           "write",
      COUNTDOWN:       "countdown",
      SHOW_NAMES:      "show_names",
      REVEAL_QUESTION: "reveal_question",
      RESULT:          "result",
      SCOREBOARD:      "scoreboard",
    };

    const DARK   = "#111111";
    const CARD   = "#1c1c1c";
    const BORDER = "#2a2a2a";
    const ACCENT = "#e8c547";
    const TEXT   = "#f0f0f0";
    const MUTED  = "#888888";
    const RED    = "#e05252";
    const GREEN  = "#52c98a";

    const css = `
      @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap');
      * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; -webkit-user-select: none; }
      input, textarea { user-select: text; -webkit-user-select: text; }
      body { margin: 0; background: ${DARK}; overscroll-behavior-y: none; }
      .btn-active { transition: transform 0.1s ease, filter 0.2s ease; }
      .btn-active:active { transform: scale(0.96); filter: brightness(0.9); }
      .input-focus:focus { border-color: ${ACCENT} !important; outline: none; box-shadow: 0 0 0 2px ${ACCENT}44; }
      ::-webkit-scrollbar { width: 0px; background: transparent; }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to   { opacity: 1; transform: translateY(0); }
      }
      @keyframes startPulse {
        0%, 100% { box-shadow: 0 8px 32px ${ACCENT}40; }
        50%       { box-shadow: 0 8px 48px ${ACCENT}70; }
      }
      @keyframes badgePop {
        0%   { transform: scale(0.8); opacity: 0; }
        60%  { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
      }
    `;

    const S = {
      page: {
        height: "100svh",
        background: DARK,
        fontFamily: "'Outfit', sans-serif",
        color: TEXT,
        display: "flex",
        flexDirection: "column",
        overflow: "hidden",
        animation: "fadeIn 0.2s ease-in-out",
      },
      inner: {
        flex: 1,
        display: "flex",
        flexDirection: "column",
        padding: "32px 24px 24px",
        maxWidth: "500px",
        width: "100%",
        margin: "0 auto",
        overflowY: "auto"
      },
      footer: {
        padding: "16px 24px calc(24px + env(safe-area-inset-bottom))",
        maxWidth: "500px",
        width: "100%",
        margin: "0 auto",
        background: DARK,
        borderTop: `1px solid ${BORDER}`
      },
      contentCenter: {
        flex: 1,
        display: "flex",
        flexDirection: "column",
        justifyContent: "center",
        paddingBottom: "40px",
      }
    };

    const Tag = ({ children, color = MUTED }) => (
      <span style={{ fontSize: 13, fontWeight: 800, letterSpacing: "0.12em", textTransform: "uppercase", color, display: "block", marginBottom: 12 }}>
        {children}
      </span>
    );

    const BigBtn = ({ onClick, children, bg = ACCENT, color = "#111", disabled = false, style = {} }) => (
      <button className={disabled ? "" : "btn-active"} onClick={onClick} disabled={disabled} style={{
        width: "100%",
        padding: "20px 24px",
        background: disabled ? BORDER : bg,
        color: disabled ? "#555" : color,
        border: "none",
        borderRadius: 20,
        fontSize: 20,
        fontWeight: 800,
        fontFamily: "'Outfit', sans-serif",
        cursor: disabled ? "not-allowed" : "pointer",
        letterSpacing: "-0.01em",
        boxShadow: disabled ? "none" : `0 8px 24px ${bg}25`,
        opacity: disabled ? 0.7 : 1,
        ...style
      }}>{children}</button>
    );

    const GhostBtn = ({ onClick, children, style = {} }) => (
      <button className="btn-active" onClick={onClick} style={{
        width: "100%",
        padding: "20px 24px",
        background: "transparent",
        color: MUTED,
        border: `2px solid ${BORDER}`,
        borderRadius: 20,
        fontSize: 18,
        fontWeight: 700,
        fontFamily: "'Outfit', sans-serif",
        cursor: "pointer",
        ...style
      }}>{children}</button>
    );

    const Card = ({ children, style = {} }) => (
      <div style={{ background: CARD, borderRadius: 20, border: `1px solid ${BORDER}`, padding: "24px", ...style }}>
        {children}
      </div>
    );

    const Divider = () => <div style={{ height: 2, background: BORDER, margin: "24px 0", borderRadius: 2 }} />;

    // â”€â”€â”€ Custom Prompts Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    const PromptsModal = ({ customQuestions, onAdd, onDelete, onClose }) => {
      const [qText, setQText] = useState("");
      const [qError, setQError] = useState("");
      const [hidden, setHidden] = useState(() => {
        try { return localStorage.getItem("imposter_prompts_hidden") === "true"; } catch { return false; }
      });

      const toggleHidden = () => setHidden(h => {
        const next = !h;
        try { localStorage.setItem("imposter_prompts_hidden", String(next)); } catch {}
        return next;
      });

      const handleAdd = () => {
        if (qText.trim()) {
          let suffix = qText.trim();
          if (!suffix.endsWith('?')) suffix += '?';
          const fullQ = `Wie zou het meest waarschijnlijk ${suffix}`;
          
          const allQuestions = [...customQuestions, ...INITIAL_PROMPTS];
          const isDuplicate = allQuestions.some(q => q.toLowerCase() === fullQ.toLowerCase());
          if (isDuplicate) {
            setQError("Deze vraag is al toegevoegd.");
            return;
          }
          
          onAdd(fullQ);
          setQText("");
          setQError("");
        }
      };

      return (
        <div style={{ 
          position: "fixed", 
          inset: 0, 
          background: "rgba(17,17,17,0.9)", 
          backdropFilter: "blur(12px)", 
          WebkitBackdropFilter: "blur(12px)",
          zIndex: 100, 
          display: "flex", 
          flexDirection: "column", 
          alignItems: "center",
          fontFamily: "'Outfit', sans-serif",
          animation: "fadeIn 0.2s ease-in-out",
        }}>
          <style>{css}</style>
          <div style={{ 
            width: "100%", 
            maxWidth: "500px", 
            height: "100%", 
            display: "flex", 
            flexDirection: "column", 
            padding: "24px 24px calc(24px + env(safe-area-inset-bottom))"
          }}>

            {/* â”€â”€ Sticky top: titel + invoer + sectieheader â”€â”€ */}
            <div style={{ flexShrink: 0 }}>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 32 }}>
                <h2 style={{ fontSize: 24, fontWeight: 800, color: TEXT, letterSpacing: "-0.02em" }}>Prompts beheren</h2>
                <button 
                  onClick={onClose} 
                  className="btn-active"
                  style={{ 
                    background: "rgba(255,255,255,0.1)",
                    border: "none", 
                    color: TEXT, 
                    width: 40, 
                    height: 40, 
                    borderRadius: "50%", 
                    display: "flex", 
                    alignItems: "center", 
                    justifyContent: "center", 
                    fontSize: 24, 
                    fontWeight: 400,
                    cursor: "pointer"
                  }}
                >Ã—</button>
              </div>

              <div style={{ marginBottom: 28 }}>
                <Tag color={ACCENT}>Voeg een vraag toe</Tag>
                <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                  <div style={{ fontSize: 16, color: TEXT, fontWeight: 600 }}>Wie zou het meest waarschijnlijk</div>
                  <div style={{ display: "flex", gap: 10 }}>
                    <input 
                      className="input-focus" 
                      placeholder="...dit spel winnen?" 
                      value={qText} 
                      onChange={e => { 
                        const val = e.target.value;
                        const formatted = val.length > 0 ? val.charAt(0).toLowerCase() + val.slice(1) : val;
                        setQText(formatted); 
                        if (qError) setQError(""); 
                      }}
                      onKeyDown={e => e.key === "Enter" && qText.trim() !== "" && handleAdd()}
                      style={{ 
                        flex: 1, 
                        background: "#222", 
                        border: `2px solid ${BORDER}`, 
                        borderRadius: 12, 
                        padding: 14, 
                        color: TEXT, 
                        fontFamily: "inherit", 
                        fontSize: 16,
                        minWidth: 0 
                      }} 
                    />
                    <button 
                      className={qText.trim() === "" ? "" : "btn-active"}
                      onClick={handleAdd} 
                      disabled={qText.trim() === ""}
                      style={{ 
                        background: ACCENT, 
                        color: "#111", 
                        border: "none", 
                        borderRadius: 12, 
                        padding: "0 20px", 
                        fontWeight: 700, 
                        fontSize: 24,
                        cursor: qText.trim() === "" ? "default" : "pointer",
                        opacity: qText.trim() === "" ? 0.3 : 1,
                        filter: qText.trim() === "" ? "grayscale(0.5)" : "none",
                        transition: "all 0.3s ease"
                      }}
                    >+</button>
                  </div>
                  {qError && (
                    <div style={{ display: "flex", alignItems: "center", gap: 8, marginTop: 10, color: "#e07070", fontSize: 14, fontWeight: 600 }}>
                      <span>âš ï¸</span><span>{qError}</span>
                    </div>
                  )}
                </div>
              </div>

              {/* â”€â”€ Sectieheader met verberg-toggle â”€â”€ */}
              <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 10, gap: 8 }}>
                <span style={{ fontSize: 11, fontWeight: 800, letterSpacing: "0.12em", textTransform: "uppercase", color: MUTED }}>
                  Toegevoegde vragen {customQuestions.length > 0 && `(${customQuestions.length})`}
                </span>
                {customQuestions.length > 0 && (
                  <button
                    className="btn-active"
                    onClick={() => toggleHidden()}
                    style={{
                      background: `${ACCENT}15`,
                      border: `1px solid ${ACCENT}30`,
                      borderRadius: 100,
                      padding: "3px 10px",
                      fontSize: 16,
                      fontWeight: 700,
                      color: `${ACCENT}`,
                      cursor: "pointer",
                      fontFamily: "'Outfit', sans-serif",
                      flexShrink: 0,
                      whiteSpace: "nowrap",
                    }}
                  >
                    {hidden ? "ğŸ‘ï¸" : "ğŸ™ˆ"}
                  </button>
                )}
              </div>
            </div>

            {/* â”€â”€ Scrollbare lijst â”€â”€ */}
            <div style={{ flex: 1, overflowY: "auto" }}>
              {customQuestions.length === 0 ? (
                <div style={{ color: MUTED, fontSize: 16, textAlign: "center", marginTop: 20 }}>Nog geen eigen vragen toegevoegd.</div>
              ) : (
                customQuestions.slice().reverse().map((q, idx) => (
                  <div key={idx} style={{ padding: "16px 0", borderBottom: `1px solid ${BORDER}`, display: "flex", justifyContent: "space-between", alignItems: "center", gap: 12 }}>
                    <div style={{ flex: 1, lineHeight: 1.4 }}>
                      {hidden ? (
                        <div style={{ display: "flex", flexDirection: "column", gap: 7 }}>
                          <div style={{ height: 11, borderRadius: 6, background: "#2e2e2e", width: `${50 + (idx * 37 + 17) % 38}%` }} />
                          <div style={{ height: 11, borderRadius: 6, background: "#272727", width: `${28 + (idx * 53 + 7) % 36}%` }} />
                        </div>
                      ) : (
                        <div style={{ color: TEXT, fontSize: 16, fontWeight: 500 }}>{q}</div>
                      )}
                    </div>
                    <button onClick={() => !hidden && onDelete(q)} className={hidden ? "" : "btn-active"} style={{ background: hidden ? "#2a2a2a" : RED, color: "#fff", border: "none", borderRadius: "50%", width: 32, height: 32, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 18, fontWeight: 800, cursor: hidden ? "default" : "pointer", flexShrink: 0, opacity: hidden ? 0.2 : 1, transition: "all 0.2s ease" }}>
                      Ã—
                    </button>
                  </div>
                ))
              )}
            </div>

            {/* â”€â”€ Klaar knop â”€â”€ */}
            <div style={{ paddingTop: 16 }}>
              <BigBtn onClick={onClose}>Klaar</BigBtn>
            </div>

          </div>
        </div>
      );
    };

    // â”€â”€â”€ Instructions Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const InstructionsModal = ({ onClose }) => {
      const steps = [
        { emoji: "ğŸ’", label: "Benodigdheden", text: "EÃ©n smartphone voor de groep + papier en pen per speler (of iets anders om op te schrijven)." },
        { emoji: "ğŸ“±", label: "Smartphone doorgeven", text: "Elke speler leest om de beurt discreet zijn vraag. De anderen kijken weg." },
        { emoji: "ğŸ˜ˆ", label: "De imposter", text: "EÃ©n speler is de imposter en krijgt een andere vraag. Hij of zij weet (nog) niet welke vraag de anderen hebben." },
        { emoji: "âœï¸", label: "Schrijf een naam op", text: "Iedereen schrijft discreet op wie bij zijn vraag past. Toon de naam nog niet!" },
        { emoji: "ğŸ“¢", label: "Toon aan de groep", text: "Na het aftellen toont iedereen welke naam hij of zij heeft opgeschreven." },
        { emoji: "ğŸ•µï¸", label: "Vind de imposter", text: "Iedereen ziet nu de vraag. Overleg en wijs dan allemaal tegelijk aan wie jij denkt dat de imposter is." },
      ];

      return (
        <div style={{
          position: "fixed",
          inset: 0,
          background: "rgba(17,17,17,0.9)",
          backdropFilter: "blur(12px)",
          WebkitBackdropFilter: "blur(12px)",
          zIndex: 100,
          display: "flex",
          flexDirection: "column",
          alignItems: "center",
          fontFamily: "'Outfit', sans-serif",
          animation: "fadeIn 0.2s ease-in-out",
        }}>
          <style>{css}</style>
          <div style={{
            width: "100%",
            maxWidth: "500px",
            height: "100%",
            display: "flex",
            flexDirection: "column",
            padding: "24px 24px calc(24px + env(safe-area-inset-bottom))"
          }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 32 }}>
              <h2 style={{ fontSize: 24, fontWeight: 800, color: TEXT, letterSpacing: "-0.02em", margin: 0 }}>Hoe werkt het spel?</h2>
              <button
                onClick={onClose}
                className="btn-active"
                style={{
                  background: "rgba(255,255,255,0.1)",
                  border: "none",
                  color: TEXT,
                  width: 40,
                  height: 40,
                  borderRadius: "50%",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  fontSize: 24,
                  fontWeight: 400,
                  cursor: "pointer",
                  flexShrink: 0,
                }}
              >Ã—</button>
            </div>

            <div style={{ flex: 1, overflowY: "auto", display: "flex", flexDirection: "column", gap: 0 }}>
              {steps.map((step, i) => (
                <div key={i} style={{
                  display: "flex",
                  gap: 20,
                  paddingBottom: 28,
                  position: "relative",
                }}>
                  <div style={{ display: "flex", flexDirection: "column", alignItems: "center", flexShrink: 0 }}>
                    <div style={{
                      width: 36,
                      height: 36,
                      borderRadius: "50%",
                      background: "#222",
                      border: `1px solid ${BORDER}`,
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "center",
                      fontSize: 18,
                      flexShrink: 0,
                    }}>{step.emoji}</div>
                    {i < steps.length - 1 && (
                      <div style={{ width: 1, flex: 1, background: BORDER, marginTop: 8 }} />
                    )}
                  </div>
                  <div style={{ paddingTop: 6 }}>
                    <div style={{ fontSize: 17, fontWeight: 700, color: TEXT, marginBottom: 4 }}>{step.label}</div>
                    <div style={{ fontSize: 15, color: MUTED, lineHeight: 1.55, fontWeight: 500 }}>{step.text}</div>
                  </div>
                </div>
              ))}

              <div style={{ paddingTop: 24, borderTop: `1px solid ${BORDER}`, marginBottom: 20 }}>
                <div style={{ fontSize: 14, color: "#555", fontWeight: 700, letterSpacing: "0.06em", textTransform: "uppercase", marginBottom: 8 }}>Punten</div>
                <div style={{ fontSize: 15, color: MUTED, lineHeight: 1.6, fontWeight: 500 }}>
                  Imposter gevonden â†’ de groep wint <strong style={{color: TEXT}}>1 punt</strong>.<br/>
                  Niet gevonden â†’ de imposter wint <strong style={{color: TEXT}}>2 punten</strong>.
                </div>
              </div>
            </div>

            <div style={{ paddingTop: 16 }}>
              <BigBtn onClick={onClose}>Duidelijk!</BigBtn>
            </div>
          </div>
        </div>
      );
    };

    // â”€â”€â”€ Settings Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const Toggle = ({ enabled, onToggle }) => (
      <div
        className="btn-active"
        onClick={onToggle}
        style={{
          width: 52,
          height: 30,
          borderRadius: 100,
          background: enabled ? ACCENT : "#333",
          position: "relative",
          cursor: "pointer",
          flexShrink: 0,
          transition: "background 0.2s ease",
          border: "none",
        }}
      >
        <div style={{
          position: "absolute",
          top: 3,
          left: enabled ? 25 : 3,
          width: 24,
          height: 24,
          borderRadius: "50%",
          background: enabled ? "#111" : "#666",
          transition: "left 0.2s ease, background 0.2s ease",
        }} />
      </div>
    );

    const Stepper = ({ value, onChange, min, max, step = 1, format = v => v }) => (
      <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
        <button
          className="btn-active"
          onClick={() => onChange(Math.max(min, value - step))}
          disabled={value <= min}
          style={{
            width: 36, height: 36, borderRadius: "50%",
            background: value <= min ? "#222" : "#2a2a2a",
            border: `1px solid ${BORDER}`,
            color: value <= min ? "#444" : TEXT,
            fontSize: 20, fontWeight: 700,
            cursor: value <= min ? "not-allowed" : "pointer",
            display: "flex", alignItems: "center", justifyContent: "center",
            flexShrink: 0,
          }}
        >âˆ’</button>
        <div style={{ fontSize: 18, fontWeight: 800, color: ACCENT, minWidth: 60, textAlign: "center" }}>
          {format(value)}
        </div>
        <button
          className="btn-active"
          onClick={() => onChange(Math.min(max, value + step))}
          disabled={value >= max}
          style={{
            width: 36, height: 36, borderRadius: "50%",
            background: value >= max ? "#222" : "#2a2a2a",
            border: `1px solid ${BORDER}`,
            color: value >= max ? "#444" : TEXT,
            fontSize: 20, fontWeight: 700,
            cursor: value >= max ? "not-allowed" : "pointer",
            display: "flex", alignItems: "center", justifyContent: "center",
            flexShrink: 0,
          }}
        >+</button>
      </div>
    );

    const APP_VERSION = "2.0.0";
    const LANGUAGES = [
      { code: "nl", label: "Nederlands"},
      { code: "en", label: "English"},
    ];

    const SettingsModal = ({ settings, onSave, onClose }) => {
      const [local, setLocal] = useState({ ...settings });

      const update = (key, val) => setLocal(prev => ({ ...prev, [key]: val }));

      return (
        <div style={{
          position: "fixed",
          inset: 0,
          background: "rgba(17,17,17,0.9)",
          backdropFilter: "blur(12px)",
          WebkitBackdropFilter: "blur(12px)",
          zIndex: 100,
          display: "flex",
          flexDirection: "column",
          alignItems: "center",
          fontFamily: "'Outfit', sans-serif",
          animation: "fadeIn 0.2s ease-in-out",
        }}>
          <style>{css}</style>
          <div style={{
            width: "100%",
            maxWidth: "500px",
            height: "100%",
            display: "flex",
            flexDirection: "column",
            padding: "24px 24px calc(24px + env(safe-area-inset-bottom))"
          }}>
            {/* Header */}
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 32 }}>
              <h2 style={{ fontSize: 24, fontWeight: 800, color: TEXT, letterSpacing: "-0.02em", margin: 0 }}>Instellingen</h2>
              <button
                onClick={onClose}
                className="btn-active"
                style={{
                  background: "rgba(255,255,255,0.1)",
                  border: "none",
                  color: TEXT,
                  width: 40,
                  height: 40,
                  borderRadius: "50%",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  fontSize: 24,
                  fontWeight: 400,
                  cursor: "pointer",
                  flexShrink: 0,
                }}
              >Ã—</button>
            </div>

            <div style={{ flex: 1, overflowY: "auto" }}>

              {/* Taal */}
              <div style={{ paddingBottom: 24, marginBottom: 4, borderBottom: `1px solid ${BORDER}` }}>
                <div style={{ display: "flex", alignItems: "center", gap: 14, marginBottom: 6 }}>
                  <span style={{ fontSize: 22, lineHeight: 1 }}>ğŸŒ</span>
                  <div>
                    <div style={{ fontSize: 17, fontWeight: 700, color: TEXT, marginBottom: 5 }}>Taal</div>
                    <div style={{ fontSize: 14, color: MUTED, fontWeight: 500 }}>Kies de taal van de app.</div>
                  </div>
                </div>
                <div style={{ display: "flex", gap: 10, paddingLeft: 36, marginTop: 14 }}>
                  {LANGUAGES.map(lang => (
                    <button
                      key={lang.code}
                      className="btn-active"
                      onClick={() => update("language", lang.code)}
                      style={{
                        flex: 1,
                        padding: "12px 10px",
                        borderRadius: 14,
                        border: `2px solid ${(local.language || "nl") === lang.code ? ACCENT : BORDER}`,
                        background: (local.language || "nl") === lang.code ? `${ACCENT}15` : "#1a1a1a",
                        color: (local.language || "nl") === lang.code ? ACCENT : MUTED,
                        fontFamily: "'Outfit', sans-serif",
                        fontSize: 14,
                        fontWeight: 700,
                        cursor: "pointer",
                        display: "flex",
                        alignItems: "center",
                        justifyContent: "center",
                        gap: 8,
                        transition: "all 0.15s ease",
                      }}
                    >
                      <span style={{ fontSize: 18 }}>{lang.flag}</span>
                      {lang.label}
                    </button>
                  ))}
                </div>
                <div style={{ fontSize: 12, color: "#555", fontWeight: 600, marginTop: 10, paddingLeft: 36 }}>
                  Meer talen volgen in een toekomstige update.
                </div>
              </div>

              {/* Over de app */}
              <div style={{ padding: "20px 0", borderBottom: `1px solid ${BORDER}` }}>
                <div style={{ display: "flex", alignItems: "center", gap: 14, marginBottom: 16 }}>
                  <span style={{ fontSize: 22, lineHeight: 1 }}>ğŸ“±</span>
                  <div style={{ fontSize: 17, fontWeight: 700, color: TEXT }}>Over de app</div>
                </div>
                <div style={{ paddingLeft: 36, display: "flex", flexDirection: "column", gap: 12 }}>
                  {[
                    { label: "App naam", value: "Imposter â€” The Party Game" },
                    { label: "Versie", value: APP_VERSION },
                  ].map(item => (
                    <div key={item.label} style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                      <span style={{ fontSize: 14, color: MUTED, fontWeight: 600 }}>{item.label}</span>
                      <span style={{ fontSize: 14, color: TEXT, fontWeight: 700 }}>{item.value}</span>
                    </div>
                  ))}
                </div>
              </div>

              {/* Juridisch */}
              <div style={{ padding: "20px 0" }}>
                <div style={{ display: "flex", alignItems: "center", gap: 14, marginBottom: 14 }}>
                  <span style={{ fontSize: 22, lineHeight: 1 }}>ğŸ“„</span>
                  <div style={{ fontSize: 17, fontWeight: 700, color: TEXT }}>Juridisch</div>
                </div>
                <div style={{ paddingLeft: 36, display: "flex", flexDirection: "column" }}>
                  {["Privacybeleid", "Gebruiksvoorwaarden"].map(item => (
                    <div key={item} style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "12px 0", borderBottom: `1px solid ${BORDER}` }}>
                      <span style={{ fontSize: 15, color: MUTED, fontWeight: 600 }}>{item}</span>
                      <span style={{ fontSize: 18, color: "#444" }}>â€º</span>
                    </div>
                  ))}
                </div>
                <div style={{ fontSize: 12, color: "#444", fontWeight: 600, marginTop: 12, paddingLeft: 36 }}>
                  Meer informatie volgt in een toekomstige update.
                </div>
              </div>

            </div>

            <div style={{ paddingTop: 16 }}>
              <BigBtn onClick={() => { onSave(local); onClose(); }}>Sluiten</BigBtn>
            </div>
          </div>
        </div>
      );
    };

    // â”€â”€â”€ Screens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    // SetupScreen heeft een eigen inputRef voor autofocus na toevoegen
    const SetupScreen = ({ players, newPlayer, setNewPlayer, addPlayer, removePlayer, startGame, onOpenPrompts, onOpenInstructions, onOpenSettings, questionError, playerError, setPlayerError, settings = {}, onUpdateSettings }) => {
      const inputRef = useRef(null);

      const handleAddPlayer = () => {
        addPlayer();
        setTimeout(() => inputRef.current && inputRef.current.focus(), 0);
      };

      const updateSetting = (key, val) => {
        if (onUpdateSettings) onUpdateSettings(key, val);
      };

      const canStart = players.length >= 3 && !questionError;

      const SettingRow = ({ emoji, label, subtitle, settingKey, currentValue, noBorder, invertToggle }) => (
        <div style={{ 
          display: "flex", alignItems: "flex-start", justifyContent: "space-between", gap: 12,
          padding: "14px 0",
          borderBottom: noBorder ? "none" : `1px solid ${BORDER}`,
        }}>
          <div style={{ display: "flex", alignItems: "flex-start", gap: 14, flex: 1 }}>
            <span style={{ fontSize: 22, flexShrink: 0, lineHeight: 1, marginTop: 1 }}>{emoji}</span>
            <div>
              <div style={{ fontSize: 15, fontWeight: 700, color: TEXT, marginBottom: subtitle ? 5 : 0 }}>{label}</div>
              {subtitle && <div style={{ fontSize: 12, color: MUTED, fontWeight: 500, lineHeight: 1.4 }}>{subtitle}</div>}
            </div>
          </div>
          <div style={{ marginTop: 2 }}>
            <Toggle enabled={invertToggle ? !currentValue : currentValue} onToggle={() => updateSetting(settingKey, !currentValue)} />
          </div>
        </div>
      );

      return (
        <div style={S.page}>
          <style>{css}</style>
          <div style={{ ...S.inner, paddingTop: 32, gap: 0 }}>

            {/* â”€â”€ Header / Logo â”€â”€ */}
            <div style={{ textAlign: "center", marginBottom: 32 }}>
              <div style={{ fontSize: 12, fontWeight: 800, letterSpacing: "0.2em", color: ACCENT, textTransform: "uppercase", marginBottom: 10 }}>
                The party game
              </div>
              <div style={{ 
                fontSize: "clamp(42px, 16vw, 68px)", 
                fontWeight: 800, 
                lineHeight: 1, 
                textTransform: "uppercase", 
                letterSpacing: "-0.03em",
                position: "relative",
                display: "inline-block",
                whiteSpace: "nowrap",
              }}>
                <span>IMP</span>
                <span style={{ position: "relative", display: "inline-block" }}>
                  <span style={{ opacity: 0 }}>O</span>
                  <span style={{ 
                    position: "absolute", left: "52%", top: "50%",
                    transform: "translate(-50%, -50%)",
                    fontSize: "0.9em", lineHeight: 1, pointerEvents: "none"
                  }}>ğŸ¤«</span>
                </span>
                <span>STER</span>
              </div>
              <div style={{ fontSize: 16, color: MUTED, marginTop: 10, fontWeight: 500 }}>
                Who's most likely to...
              </div>
            </div>

            {/* â”€â”€ Action buttons: Instructies + Eigen vragen + Instellingen â”€â”€ */}
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 10, marginBottom: 14 }}>
              <button
                className="btn-active"
                onClick={onOpenInstructions}
                style={{
                  background: `${ACCENT}15`,
                  border: `1px solid ${ACCENT}30`,
                  borderRadius: 16,
                  padding: "14px 12px",
                  display: "flex", flexDirection: "column", alignItems: "center", gap: 6,
                  cursor: "pointer", fontFamily: "'Outfit', sans-serif",
                }}
              >
                <span style={{ fontSize: 20 }}>ğŸ“–</span>
                <span style={{ fontSize: 12, fontWeight: 700, color: TEXT, lineHeight: 1.2, textAlign: "center" }}>Handleiding</span>
              </button>
              <button
                className="btn-active"
                onClick={onOpenPrompts}
                style={{
                  background: `${ACCENT}15`,
                  border: `1px solid ${ACCENT}30`,
                  borderRadius: 16,
                  padding: "14px 12px",
                  display: "flex", flexDirection: "column", alignItems: "center", gap: 6,
                  cursor: "pointer", fontFamily: "'Outfit', sans-serif",
                  position: "relative",
                }}
              >
                {settings.customOnly && (
                  <span style={{
                    position: "absolute", top: -6, right: -6,
                    background: ACCENT, color: "#111",
                    borderRadius: 100, fontSize: 9, fontWeight: 800,
                    padding: "2px 7px", letterSpacing: "0.05em", textTransform: "uppercase",
                    animation: "badgePop 0.3s ease",
                  }}>Actief</span>
                )}
                <span style={{ fontSize: 20 }}>âœï¸</span>
                <span style={{ fontSize: 12, fontWeight: 700, color: TEXT, lineHeight: 1.2, textAlign: "center" }}>Eigen vragen</span>
              </button>
              <button
                onClick={undefined}
                style={{
                  background: `${ACCENT}15`,
                  border: `1px solid ${ACCENT}30`,
                  borderRadius: 16,
                  padding: "14px 12px",
                  display: "flex", flexDirection: "column", alignItems: "center", gap: 6,
                  cursor: "not-allowed", fontFamily: "'Outfit', sans-serif",
                  opacity: 0.5,
                  pointerEvents: "none",
                }}
              >
                <span style={{ fontSize: 20 }}>âš™ï¸</span>
                <span style={{ fontSize: 12, fontWeight: 700, color: TEXT, lineHeight: 1.2, textAlign: "center" }}>Instellingen</span>
              </button>
            </div>

            {/* â”€â”€ Spelers â”€â”€ */}
            <Card style={{ marginBottom: 14 }}>
              <Tag>Spelers ({players.length}/8)</Tag>
              {players.length > 0 && (
                <div style={{ display: "flex", flexWrap: "wrap", gap: 8, marginBottom: 16 }}>
                  {players.map((p, i) => (
                    <div key={p} className="btn-active" onClick={() => removePlayer(i)} style={{
                      display: "flex", alignItems: "center", gap: 6, background: "#2a2a2a",
                      borderRadius: 100, padding: "8px 14px 8px 18px", fontSize: 16, fontWeight: 600, cursor: "pointer"
                    }}>
                      {p}
                      <div style={{ background: DARK, color: MUTED, borderRadius: "50%", width: 22, height: 22, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 16, fontWeight: 800, paddingBottom: 2 }}>Ã—</div>
                    </div>
                  ))}
                </div>
              )}
              <div style={{ display: "flex", gap: 10 }}>
                <input
                  ref={inputRef}
                  className="input-focus"
                  value={newPlayer}
                  onChange={e => {
                    const val = e.target.value;
                    const formattedVal = val.charAt(0).toUpperCase() + val.slice(1);
                    setNewPlayer(formattedVal);
                    if (playerError) setPlayerError("");
                  }}
                  onKeyDown={e => e.key === "Enter" && newPlayer.trim() !== "" && players.length < 8 && handleAddPlayer()}
                  placeholder={players.length >= 8 ? "Max. spelers bereikt" : "Speler toevoegenâ€¦"}
                  disabled={players.length >= 8}
                  style={{
                    flex: 1, 
                    background: players.length >= 8 ? "#1a1a1a" : "#222", 
                    border: `2px solid ${BORDER}`, 
                    borderRadius: 12,
                    padding: "13px", 
                    color: players.length >= 8 ? "#444" : TEXT, 
                    fontSize: 17, 
                    minWidth: 0, 
                    fontWeight: 600, 
                    fontFamily: "'Outfit', sans-serif",
                    cursor: players.length >= 8 ? "not-allowed" : "text",
                  }}
                />
                <button 
                  className={newPlayer.trim() === "" || players.length >= 8 ? "" : "btn-active"} 
                  onClick={handleAddPlayer} 
                  disabled={newPlayer.trim() === "" || players.length >= 8}
                  style={{
                    background: ACCENT, color: "#111", border: "none", 
                    borderRadius: 12, padding: "0 18px", fontSize: 26, fontWeight: 700, 
                    cursor: newPlayer.trim() === "" || players.length >= 8 ? "not-allowed" : "pointer", 
                    flexShrink: 0,
                    opacity: newPlayer.trim() === "" || players.length >= 8 ? 0.3 : 1,
                    filter: newPlayer.trim() === "" || players.length >= 8 ? "grayscale(0.5)" : "none",
                    transition: "all 0.3s ease"
                  }}
                >+</button>
              </div>
              {playerError && (
                <div style={{ display: "flex", alignItems: "center", gap: 8, marginTop: 10, color: "#e07070", fontSize: 14, fontWeight: 600 }}>
                  <span>âš ï¸</span><span>{playerError}</span>
                </div>
              )}
            </Card>

            {/* â”€â”€ Spelinstellingen â”€â”€ */}
            <Card style={{ marginBottom: 0 }}>
              <Tag>Spelopties</Tag>

              <SettingRow emoji="â±ï¸" label="Discussietimer" subtitle="Automatisch aftellen tijdens het overleggen." settingKey="timerEnabled" currentValue={settings.timerEnabled} />
              {settings.timerEnabled && (
                <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "10px 0 12px 36px", borderBottom: `1px solid ${BORDER}` }}>
                  <span style={{ fontSize: 13, fontWeight: 600, color: MUTED }}>Tijdsduur</span>
                  <Stepper value={settings.timerSeconds} onChange={v => updateSetting("timerSeconds", v)} min={15} max={180} step={15} format={v => `${v}s`} />
                </div>
              )}

              <SettingRow emoji="ğŸ†" label="Eindscore" subtitle="Het spel eindigt als iemand dit aantal punten haalt." settingKey="targetEnabled" currentValue={settings.targetEnabled} />
              {settings.targetEnabled && (
                <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "10px 0 12px 36px", borderBottom: `1px solid ${BORDER}` }}>
                  <span style={{ fontSize: 13, fontWeight: 600, color: MUTED }}>Punten om te winnen</span>
                  <Stepper value={settings.targetScore} onChange={v => updateSetting("targetScore", v)} min={3} max={30} step={1} format={v => `${v} pt`} />
                </div>
              )}
              <SettingRow emoji="ğŸ“" label="Enkel eigen vragen" subtitle="Schakelt de standaardvragen uit. Enkel jouw toegevoegde prompts worden gebruikt." settingKey="customOnly" currentValue={settings.customOnly} />
              <SettingRow emoji="ğŸ˜ˆ" label="Bewuste imposter" subtitle="De imposter weet tijdens het lezen van de vraag dat hij/zij de imposter is." settingKey="blindImposter" currentValue={settings.blindImposter} invertToggle noBorder />
            </Card>

            <div style={{ textAlign: "center", marginTop: 20, marginBottom: 0, lineHeight: 1.5 }}>
              <div style={{ fontSize: 12, fontWeight: 700, color: "#444", letterSpacing: "0.05em" }}>Imposter â€” The Party Game</div>
              <div style={{ fontSize: 10, fontWeight: 600, color: "#333", letterSpacing: "0.05em" }}>versie {APP_VERSION} (beta)</div>
            </div>

          </div>

          <div style={S.footer}>
            {questionError && (
              <div style={{
                background: "#2a1010", border: `1px solid #6a1a1a`,
                borderRadius: 20, padding: "14px 18px", marginBottom: 12,
                display: "flex", alignItems: "center", gap: 12,
              }}>
                <span style={{ fontSize: 20 }}>âš ï¸</span>
                <div style={{ fontSize: 15, fontWeight: 600, color: "#e07070", lineHeight: 1.4 }}>{questionError}</div>
              </div>
            )}
            <BigBtn
              onClick={startGame}
              disabled={!canStart}
              style={canStart ? { animation: "startPulse 2.5s ease-in-out infinite" } : {}}
            >
              {players.length < 3 ? `Nog ${3 - players.length} speler${3 - players.length !== 1 ? "s" : ""} nodig` : "ğŸš€ Spel starten"}
            </BigBtn>
          </div>
        </div>
      );
    };

    const QuestionTurnScreen = ({ player, round, current, total, onShow }) => (
      <div style={S.page}>
        <style>{css}</style>
        <div style={S.inner}>
          <div style={S.contentCenter}>
            <div style={{ fontSize: 14, color: MUTED, fontWeight: 700, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 50 }}>
              Ronde {round} &nbsp;Â·&nbsp; {current}/{total}
            </div>
            <div style={{ fontSize: 80, marginBottom: 30 }}>ğŸ‘€</div>
            <div style={{ fontSize: 40, fontWeight: 800, marginBottom: 16, letterSpacing: "-0.02em" }}>
              Hey <span style={{ color: ACCENT }}>{player}</span>
            </div>
            <div style={{ fontSize: 20, color: MUTED, lineHeight: 1.5, fontWeight: 500 }}>
              Pak de telefoon en lees jouw vraag.<br />De anderen kijken weg.
            </div>
          </div>
        </div>
        <div style={S.footer}>
          <BigBtn onClick={onShow}>Toon mijn vraag</BigBtn>
        </div>
      </div>
    );

    const ShowQuestionScreen = ({ isImposter, question, isLast, onDone, blindImposter }) => {
      // Als blinde imposter aan staat, ziet de imposter exact hetzelfde als een gewone speler
      const showAsImposter = isImposter && !blindImposter;
      return (
      <div style={{ ...S.page, background: showAsImposter ? "#1a0b0b" : DARK }}>
        <style>{css}</style>
        <div style={S.inner}>
          <div style={S.contentCenter}>
            {showAsImposter && (
              <div style={{
                display: "inline-block", background: "#3a1212", border: `2px solid #6a1a1a`,
                borderRadius: 100, padding: "8px 20px", fontSize: 14, fontWeight: 800,
                color: RED, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 30, alignSelf: "flex-start"
              }}>
              ğŸ˜ˆ Jij bent de imposter
              </div>
            )}
            <Tag color={showAsImposter ? RED : ACCENT}>Jouw vraag</Tag>
            <div style={{ fontSize: 32, fontWeight: 800, lineHeight: 1.4, marginBottom: 40, letterSpacing: "-0.02em" }}>
              {question}
            </div>
            <div style={{ fontSize: 18, color: MUTED, lineHeight: 1.6, fontWeight: 500 }}>
              Onthoud je vraag goed.<br />Vertel niets aan de anderen. ğŸ¤
            </div>
          </div>
        </div>
        <div style={S.footer}>
          <BigBtn onClick={onDone} bg={showAsImposter ? RED : ACCENT} color={showAsImposter ? "#fff" : "#111"}>
            {isLast ? "Iedereen heeft gelezen" : "Verbergen en doorgeven"}
          </BigBtn>
        </div>
      </div>
      );
    };

    const WriteScreen = ({ onReady }) => (
      <div style={S.page}>
        <style>{css}</style>
        <div style={S.inner}>
          <div style={{ ...S.contentCenter, textAlign: "center" }}>
            <div style={{ fontSize: 80, marginBottom: 30 }}>âœï¸</div>
            <div style={{ fontSize: 36, fontWeight: 800, marginBottom: 20, letterSpacing: "-0.02em" }}>Schrijf een naam op</div>
            <div style={{ fontSize: 20, color: MUTED, marginBottom: 16, lineHeight: 1.6, fontWeight: 500 }}>
              Schrijf discreet op wie volgens jou bij de vraag past.
            </div>
            <div style={{ fontSize: 16, color: "#666", fontWeight: 500 }}>
              Nog niet tonen!
            </div>
          </div>
        </div>
        <div style={S.footer}>
          <BigBtn onClick={onReady}>Onthul de namen</BigBtn>
        </div>
      </div>
    );

    const useCountdownSound = (countdown) => {
  const audioCtxRef = React.useRef(null);

  React.useEffect(() => {
    if (countdown < 0) return;

    // Maak AudioContext aan (of hergebruik)
    if (!audioCtxRef.current) {
      audioCtxRef.current = new (window.AudioContext || window.webkitAudioContext)();
    }
    const ctx = audioCtxRef.current;

    const playBeep = (frequency, duration, gain = 0.3) => {
      const oscillator = ctx.createOscillator();
      const gainNode = ctx.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(ctx.destination);

      oscillator.type = "sine";
      oscillator.frequency.setValueAtTime(frequency, ctx.currentTime);

      gainNode.gain.setValueAtTime(gain, ctx.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);

      oscillator.start(ctx.currentTime);
      oscillator.stop(ctx.currentTime + duration);
    };

    if (countdown > 0) {
      // Korte lage beep voor 3, 2, 1
      playBeep(440, 0.15, 0.3);
    } else {
      // Langere hoge "go!" toon
      playBeep(880, 0.12, 0.4);
      setTimeout(() => playBeep(1100, 0.3, 0.35), 120);
    }
  }, [countdown]);
};

const CountdownScreen = ({ countdown }) => {
  useCountdownSound(countdown);

  return (
    <div style={S.page}>
      <style>{css}</style>
      <div style={{ ...S.inner, justifyContent: "center", alignItems: "center", textAlign: "center" }}>
        <div style={{ fontSize: 18, color: MUTED, fontWeight: 800, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 40 }}>
          {countdown > 0 ? "Klaar om te tonen?" : "Toon je naam!"}
        </div>
        <div style={{
          fontSize: countdown === 0 ? 140 : 180,
          fontWeight: 800, lineHeight: 1,
          color: countdown === 0 ? ACCENT : TEXT,
          letterSpacing: "-0.04em",
          textShadow: countdown === 0 ? `0 0 60px ${ACCENT}88` : "none",
          transition: "all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",
          transform: countdown === 0 ? "scale(1.2)" : "scale(1)",
        }}>
          {countdown === 0 ? "ğŸ“¢" : countdown}
        </div>
      </div>
    </div>
  );
};

    const ShowNamesScreen = ({ onReveal }) => (
      <div style={S.page}>
        <style>{css}</style>
        <div style={S.inner}>
          <div style={{ ...S.contentCenter, textAlign: "center" }}>
            <div style={{ fontSize: 80, marginBottom: 30 }}>ğŸ‘€</div>
            <div style={{ fontSize: 36, fontWeight: 800, marginBottom: 20, letterSpacing: "-0.02em" }}>Namen tonen!</div>
            <div style={{ fontSize: 20, color: MUTED, lineHeight: 1.6, fontWeight: 500 }}>
              Heeft iedereen de namen gezien?<br />Druk dan op de knop om de vraag te onthullen.
            </div>
          </div>
        </div>
        <div style={S.footer}>
          <BigBtn onClick={onReveal}>Toon de vraag</BigBtn>
        </div>
      </div>
    );

    // â”€â”€â”€ RevealQuestionScreen met optionele discussietimer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const READING_DELAY = 5; // seconden leestijd voor de timer start

    const RevealQuestionScreen = ({ normalQuestion, onDone, timerEnabled, timerSeconds }) => {
      const [readingLeft, setReadingLeft] = useState(timerEnabled ? READING_DELAY : 0);
      const [timeLeft, setTimeLeft] = useState(timerSeconds);
      const [timerDone, setTimerDone] = useState(false);
      const intervalRef = useRef(null);

      useEffect(() => {
        if (!timerEnabled) return;

        // Fase 1: leesvertraging
        intervalRef.current = setInterval(() => {
          setReadingLeft(r => {
            if (r <= 1) {
              clearInterval(intervalRef.current);
              // Fase 2: discussietimer starten
              intervalRef.current = setInterval(() => {
                setTimeLeft(t => {
                  if (t <= 1) {
                    clearInterval(intervalRef.current);
                    setTimerDone(true);
                    return 0;
                  }
                  return t - 1;
                });
              }, 1000);
              return 0;
            }
            return r - 1;
          });
        }, 1000);

        return () => clearInterval(intervalRef.current);
      }, []);

      const isReading = timerEnabled && readingLeft > 0;
      const progress = timerEnabled && !isReading ? (timeLeft / timerSeconds) : 1;
      const timerColor = timeLeft <= 10 ? RED : timeLeft <= 20 ? "#e8a547" : GREEN;

      return (
        <div style={S.page}>
          <style>{css}</style>
          <div style={S.inner}>
            <div style={S.contentCenter}>
              <Tag color={ACCENT}>De vraag was</Tag>
              <div style={{ fontSize: 32, fontWeight: 800, lineHeight: 1.4, marginBottom: 30, letterSpacing: "-0.02em" }}>
                {normalQuestion}
              </div>
              <Divider />
              <div style={{ fontSize: 20, color: MUTED, lineHeight: 1.6, fontWeight: 500 }}>
                Overleg met de groep en wijs dan allemaal <strong style={{color: TEXT}}>tegelijk</strong> naar wie jij denkt dat de imposter is. â˜ï¸
              </div>
            </div>
          </div>

          {/* Timer: buiten S.inner, vaste hoogte zodat content nooit verspringt */}
          {timerEnabled && (
            <div style={{
              padding: "12px 24px 20px",
              maxWidth: "500px",
              width: "100%",
              margin: "0 auto",
              height: 104,
              display: "flex",
              flexDirection: "column",
              justifyContent: "center",
            }}>
              {isReading ? (
                <div style={{ textAlign: "center" }}>
                  <div style={{ fontSize: 13, fontWeight: 800, letterSpacing: "0.12em", textTransform: "uppercase", color: MUTED, marginBottom: 6 }}>
                    Timer start over
                  </div>
                  <div style={{ fontSize: 36, fontWeight: 800, color: MUTED, letterSpacing: "-0.03em", lineHeight: 1 }}>
                    {readingLeft}
                  </div>
                </div>
              ) : (
                <div>
                  <div style={{ display: "flex", alignItems: "baseline", justifyContent: "center", gap: 8, marginBottom: 10 }}>
                    <div style={{
                      fontSize: 44,
                      fontWeight: 800,
                      letterSpacing: "-0.03em",
                      color: timerDone ? RED : timerColor,
                      transition: "color 0.4s ease",
                      lineHeight: 1,
                    }}>
                      {timerDone ? "â°" : timeLeft}
                    </div>
                    {!timerDone && (
                      <div style={{ fontSize: 15, color: MUTED, fontWeight: 600 }}>sec</div>
                    )}
                  </div>
                  <div style={{ background: "#222", borderRadius: 100, height: 8, overflow: "hidden" }}>
                    <div style={{
                      height: "100%",
                      borderRadius: 100,
                      width: `${progress * 100}%`,
                      background: timerColor,
                      transition: "width 1s linear, background 0.4s ease",
                    }} />
                  </div>
                  {/* Vaste hoogte reserveren zodat de balk nooit verschuift */}
                  <div style={{ height: 28, display: "flex", alignItems: "center", justifyContent: "center" }}>
                    {timerDone && (
                      <div style={{ fontSize: 14, color: RED, fontWeight: 700 }}>
                        Tijd is om! Wijs je verdachte aan.
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          )}

          <div style={S.footer}>
            <BigBtn onClick={onDone}>ğŸ•µï¸ Imposter gevonden?</BigBtn>
          </div>
        </div>
      );
    };

    const ResultScreen = ({ imposterName, normalQ, imposterQ, onFound, onNotFound }) => (
      <div style={S.page}>
        <style>{css}</style>
        <div style={{ ...S.inner, paddingTop: 40 }}>
          <div style={{ fontSize: 14, color: MUTED, fontWeight: 800, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 8 }}>
            Uitslag
          </div>
          <div style={{ fontSize: 36, fontWeight: 800, marginBottom: 12, letterSpacing: "-0.02em", lineHeight: 1.1 }}>
            Werd de imposter ontmaskerd?
          </div>
          <div style={{ fontSize: 20, color: MUTED, marginBottom: 40, fontWeight: 500 }}>
            De imposter was <strong style={{ color: TEXT, fontWeight: 800 }}>{imposterName}</strong>
          </div>

          <Card style={{ marginBottom: 40, padding: "28px 24px" }}>
            <Tag>Gewone vraag</Tag>
            <div style={{ fontSize: 18, lineHeight: 1.5, marginBottom: 20, fontWeight: 600 }}>{normalQ}</div>
            <Divider />
            <Tag color={RED}>Imposter vraag</Tag>
            <div style={{ fontSize: 18, lineHeight: 1.5, color: MUTED, fontWeight: 500 }}>{imposterQ}</div>
          </Card>
        </div>
        <div style={{ ...S.footer, display: "flex", flexDirection: "column", gap: 16 }}>
          <BigBtn onClick={onFound} bg={GREEN} color="#fff">Ja, de groep wint</BigBtn>
          <BigBtn onClick={onNotFound} bg={RED} color="#fff">Nee, {imposterName} wint</BigBtn>
        </div>
      </div>
    );

    const ScoreboardScreen = ({ players, scores, round, onPlayAgain, onNewGame, onReset, targetEnabled, targetScore }) => {
      const sorted = [...players].sort((a, b) => (scores[b] || 0) - (scores[a] || 0));
      const maxScore = Math.max(...players.map(p => scores[p] || 0), 1);
      const medals = ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"];

      const winner = targetEnabled ? sorted.find(p => (scores[p] || 0) >= targetScore) : null;

      return (
        <div style={S.page}>
          <style>{css}</style>
          <div style={S.inner}>
            <div style={{ paddingTop: 24, marginBottom: 36 }}>
              <div style={{ fontSize: 14, color: MUTED, fontWeight: 800, letterSpacing: "0.1em", textTransform: "uppercase", marginBottom: 0 }}>
                {round} ronde{round !== 1 ? "s" : ""} gespeeld
              </div>
              <div style={{ fontSize: 44, fontWeight: 800, letterSpacing: "-0.03em" }}>Scorebord</div>
            </div>

            {winner && (
              <div style={{ textAlign: "center", marginBottom: 20 }}>
                <div style={{ fontSize: 40, marginBottom: 8 }}>ğŸ†</div>
                <div style={{ fontSize: 22, fontWeight: 800, color: GREEN, marginBottom: 4 }}>{winner} is de winnaar!</div>
              </div>
            )}

            {targetEnabled && !winner && (
              <div style={{ fontSize: 14, color: MUTED, fontWeight: 600, marginBottom: 16, textAlign: "right" }}>
                Doel: {targetScore} punten
              </div>
            )}

            <Card style={{ marginBottom: 40, padding: "16px 24px" }}>
              {sorted.map((name, i) => {
                const score = scores[name] || 0;
                const isWinner = name === winner;
                return (
                  <div key={name}>
                    {i > 0 && <div style={{ height: 2, background: BORDER, margin: "16px 0", borderRadius: 2 }} />}
                    <div style={{ display: "flex", alignItems: "center", gap: 16 }}>
                      <span style={{ fontSize: 28, width: 36, textAlign: "center" }}>{medals[i] || <span style={{fontSize: 18, color: MUTED, fontWeight: 800}}>{i+1}</span>}</span>
                      <div style={{ flex: 1 }}>
                        <div style={{ fontSize: 20, fontWeight: 800, marginBottom: 8, color: isWinner ? GREEN : TEXT }}>{name}</div>
                        <div style={{ background: "#2a2a2a", borderRadius: 100, height: 8, overflow: "hidden" }}>
                          <div style={{ height: "100%", borderRadius: 100, width: `${(score / (targetEnabled ? Math.max(maxScore, targetScore) : maxScore)) * 100}%`, background: isWinner ? GREEN : i === 0 ? ACCENT : "#666", transition: "width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)" }} />
                        </div>
                        {targetEnabled && (
                          <div style={{ fontSize: 12, color: MUTED, fontWeight: 600, marginTop: 4 }}>
                            {Math.max(0, targetScore - score)} punt{Math.max(0, targetScore - score) !== 1 ? "en" : ""} te gaan
                          </div>
                        )}
                      </div>
                      <span style={{ fontSize: 28, fontWeight: 800, color: isWinner ? GREEN : i === 0 ? ACCENT : TEXT, minWidth: 40, textAlign: "right" }}>{score}</span>
                    </div>
                  </div>
                );
              })}
            </Card>
          </div>
          <div style={{ ...S.footer, display: "flex", flexDirection: "column", gap: 16 }}>
            {winner ? (
              <BigBtn onClick={onNewGame}>ğŸš€ Nieuw spel</BigBtn>
            ) : (
              <BigBtn onClick={onPlayAgain}>ğŸš€ Volgende ronde</BigBtn>
            )}
            <GhostBtn onClick={onReset}>Terug naar hoofdmenu</GhostBtn>
          </div>
        </div>
      );
    };

    // â”€â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function ImposterGame() {
      const [phase, setPhase] = useState(PHASES.SETUP);
      const [players, setPlayers] = useState(() => {
        try { return JSON.parse(localStorage.getItem("imposter_players")) || []; } catch { return []; }
      });
      const [newPlayer, setNewPlayer] = useState("");
      const [roundPlayerOrder, setRoundPlayerOrder] = useState([]);
      const [round, setRound] = useState(0);
      const [currentPlayerIdx, setCurrentPlayerIdx] = useState(0);
      const [imposterIdx, setImposterIdx] = useState(null);
      
      const [promptPool, setPromptPool] = useState(INITIAL_PROMPTS);
      const [customQuestions, setCustomQuestions] = useState(() => {
        try { return JSON.parse(localStorage.getItem("imposter_custom_questions")) || []; } catch { return []; }
      });

      // availablePrompts: vragen die nog niet zijn gebruikt deze cyclus
      const [availablePrompts, setAvailablePrompts] = useState(() => {
        try { return JSON.parse(localStorage.getItem("imposter_available_prompts")) || [...INITIAL_PROMPTS]; } catch { return [...INITIAL_PROMPTS]; }
      });
      
      const [currentNormalQ, setCurrentNormalQ] = useState("");
      const [currentImposterQ, setCurrentImposterQ] = useState("");
      
      const [countdown, setCountdown] = useState(3);
      const [scores, setScores] = useState(() => {
        try { return JSON.parse(localStorage.getItem("imposter_scores")) || {}; } catch { return {}; }
      });
      const [showPrompts, setShowPrompts] = useState(false);
      const [showInstructions, setShowInstructions] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      const [settings, setSettings] = useState(() => {
        const defaults = { timerEnabled: false, timerSeconds: 60, targetEnabled: false, targetScore: 10, customOnly: false, blindImposter: true };
        try {
          const saved = JSON.parse(localStorage.getItem("imposter_settings"));
          return saved ? { ...defaults, ...saved } : defaults;
        } catch {
          return defaults;
        }
      });
      const [questionError, setQuestionError] = useState("");
      const [playerError, setPlayerError] = useState("");
      
      // Bereken proactief of er genoeg vragen zijn
      const activePool = settings.customOnly ? customQuestions : promptPool;
      const notEnoughQuestions = activePool.length < 2;
      const effectiveQuestionError = notEnoughQuestions 
        ? (settings.customOnly 
            ? "'Enkel eigen vragen' is actief. Voeg minstens 2 vragen toe via 'Eigen vragen' om een spel te starten."
            : "Niet genoeg vragen om te starten. Voeg minstens 2 eigen vragen toe.")
        : questionError;
      const countdownRef = useRef(null);

      // â”€â”€ LocalStorage persistentie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      useEffect(() => {
        try { localStorage.setItem("imposter_custom_questions", JSON.stringify(customQuestions)); } catch {}
      }, [customQuestions]);

      useEffect(() => {
        try { localStorage.setItem("imposter_players", JSON.stringify(players)); } catch {}
      }, [players]);

      useEffect(() => {
        try { localStorage.setItem("imposter_scores", JSON.stringify(scores)); } catch {}
      }, [scores]);

      useEffect(() => {
        try { localStorage.setItem("imposter_available_prompts", JSON.stringify(availablePrompts)); } catch {}
      }, [availablePrompts]);

      useEffect(() => {
        try { localStorage.setItem("imposter_settings", JSON.stringify(settings)); } catch {}
        setQuestionError(""); // Reset fout als instellingen wijzigen
        // Reset de vragenpool als customOnly wijzigt zodat de pool altijd klopt
        setAvailablePrompts(settings.customOnly ? [...customQuestions] : [...promptPool]);
      }, [settings.customOnly]);

      useEffect(() => {
        try { localStorage.setItem("imposter_settings", JSON.stringify(settings)); } catch {}
      }, [settings]);

      // â”€â”€ Spel starten â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const startFreshGame = () => {
        const freshScores = {};
        players.forEach(p => { freshScores[p] = 0; });
        setScores(freshScores);
        setRound(0);
        setTimeout(() => startGame(players), 0);
      };

      const startGame = (p) => {
        // 1. Gebruik de bestaande spelers of de meegegeven lijst
        let pl = [...(p || players)]; 
        if (pl.length < 3) return;

        // Valideer vragen VOOR de ronde start (ook vanuit scorebord)
        const currentActivePool = settings.customOnly ? customQuestions : promptPool;
        if (currentActivePool.length < 2) {
          setQuestionError(
            settings.customOnly
              ? "'Enkel eigen vragen' actief. Voeg minstens 2 vragen toe."
              : "Niet genoeg vragen. Voeg minstens 2 eigen vragen toe."
          );
          setPhase(PHASES.SETUP);
          return;
        }
        setQuestionError("");

        // 2. Schud de spelerslijst in willekeurige volgorde voor deze ronde
        //    (setPlayers wordt NIET aangeroepen, zodat de setupvolgorde behouden blijft)
        pl = pl.sort(() => Math.random() - 0.5);
        setRoundPlayerOrder(pl);

        // De rest van je bestaande logica:
        setImposterIdx(Math.floor(Math.random() * pl.length));

        setAvailablePrompts(prev => {
          const activePool = settings.customOnly ? customQuestions : promptPool;
          if (activePool.length < 2) {
            setQuestionError("Niet genoeg vragen om te starten. Voeg minstens 2 eigen vragen toe.");
            return prev;
          }
          const pool = prev.filter(q => activePool.includes(q));
          const refilled = pool.length >= 2 ? pool : [...activePool];
          const shuffled = [...refilled].sort(() => 0.5 - Math.random());
          const nQ = shuffled[0];
          const iQ = shuffled[1];
          setCurrentNormalQ(nQ);
          setCurrentImposterQ(iQ);
          return shuffled.slice(2);
        });
        
        setCurrentPlayerIdx(0);
        setRound(r => r + 1);
        setPhase(PHASES.QUESTION_TURN);
      };

      const addCustomPrompt = (text) => {
        setCustomQuestions(prev => [...prev, text]);
        setPromptPool(prev => [...prev, text]);
        setAvailablePrompts(prev => [...prev, text]);
        setQuestionError(""); // Reset fout als er een vraag wordt toegevoegd
      };

      const removeCustomPrompt = (textToRemove) => {
        setCustomQuestions(prev => prev.filter(q => q !== textToRemove));
        setPromptPool(prev => prev.filter(q => q !== textToRemove));
        setAvailablePrompts(prev => prev.filter(q => q !== textToRemove));
      };

      const addPlayer = () => {
        const name = newPlayer.trim();
        if (!name) return;
        if (players.includes(name)) {
          setPlayerError(`"${name}" is al toegevoegd.`);
          return;
        }
        if (players.length < 8) {
          setPlayers(prev => [...prev, name]);
          setScores(prev => ({ ...prev, [name]: prev[name] || 0 }));
          setNewPlayer("");
          setPlayerError("");
        }
      };

      const removePlayer = (i) => {
        // Score wordt bewaard zodat een heringetreden speler met dezelfde naam zijn punten behoudt
        setPlayers(prev => prev.filter((_, idx) => idx !== i));
      };

      // â”€â”€ Na het lezen: ga naar volgende speler of naar WRITE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const doneReading = () => {
        if (currentPlayerIdx + 1 < roundPlayerOrder.length) {
          setCurrentPlayerIdx(i => i + 1);
          setPhase(PHASES.QUESTION_TURN);
        } else {
          setPhase(PHASES.WRITE);
        }
      };

      const startCountdown = () => { setCountdown(3); setPhase(PHASES.COUNTDOWN); };

      useEffect(() => {
        if (phase !== PHASES.COUNTDOWN) return;
        countdownRef.current = setInterval(() => {
          setCountdown(c => {
            if (c <= 1) { clearInterval(countdownRef.current); setPhase(PHASES.SHOW_NAMES); return 0; }
            return c - 1;
          });
        }, 1000);
        return () => clearInterval(countdownRef.current);
      }, [phase]);

      const handleResult = (imposterFound) => {
        setScores(prev => {
          const s = { ...prev };
          if (imposterFound) {
            roundPlayerOrder.forEach((p, i) => { if (i !== imposterIdx) s[p] = (s[p] || 0) + 1; });
          } else {
            s[roundPlayerOrder[imposterIdx]] = (s[roundPlayerOrder[imposterIdx]] || 0) + 2;
          }
          return s;
        });
        setPhase(PHASES.SCOREBOARD);
      };

      const resetGame = () => {
        setPhase(PHASES.SETUP); 
        // setPlayers([]) is weggehaald zodat ze blijven staan
        setRound(0);
        
        // Zet de scores van de huidige spelers terug op 0
        const freshScores = {};
        players.forEach(p => { freshScores[p] = 0; });
        setScores(freshScores);
        
        setImposterIdx(null);
        setAvailablePrompts([...promptPool]);
        try {
          // localStorage.removeItem("imposter_players") is weggehaald!
          localStorage.setItem("imposter_scores", JSON.stringify(freshScores));
          localStorage.removeItem("imposter_available_prompts");
        } catch {}
      };

      const stopGame = () => {
        resetGame();
      };

      const isInGame = phase !== PHASES.SETUP;

      return (
        <React.Fragment>
          {isInGame && (
            <button
              className="btn-active"
              onClick={stopGame}
              style={{
                position: "fixed",
                top: 24,
                right: "max(24px, calc((100vw - 500px) / 2 + 24px))",
                background: "rgba(255,255,255,0.1)",
                border: "none",
                color: TEXT,
                width: 40,
                height: 40,
                borderRadius: "50%",
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                fontSize: 24,
                fontWeight: 400,
                cursor: "pointer",
                flexShrink: 0,
                zIndex: 50,
              }}
            >Ã—</button>
          )}
          {showInstructions && (
            <InstructionsModal onClose={() => setShowInstructions(false)} />
          )}
          {showPrompts && (
            <PromptsModal 
              customQuestions={customQuestions} 
              onAdd={addCustomPrompt} 
              onDelete={removeCustomPrompt}
              onClose={() => setShowPrompts(false)} 
            />
          )}
          {showSettings && (
            <SettingsModal
              settings={settings}
              onSave={setSettings}
              onClose={() => setShowSettings(false)}
            />
          )}
          
          {phase === PHASES.SETUP && (
            <SetupScreen players={players} newPlayer={newPlayer} setNewPlayer={setNewPlayer} addPlayer={addPlayer} removePlayer={removePlayer} startGame={() => startGame()} onOpenPrompts={() => setShowPrompts(true)} onOpenInstructions={() => setShowInstructions(true)} onOpenSettings={() => setShowSettings(true)} questionError={effectiveQuestionError} playerError={playerError} setPlayerError={setPlayerError} settings={settings} onUpdateSettings={(key, val) => setSettings(prev => ({ ...prev, [key]: val }))} />
          )}
          {phase === PHASES.QUESTION_TURN && (
            <QuestionTurnScreen player={roundPlayerOrder[currentPlayerIdx]} round={round} current={currentPlayerIdx + 1} total={roundPlayerOrder.length} onShow={() => setPhase(PHASES.SHOW_QUESTION)} />
          )}
          {phase === PHASES.SHOW_QUESTION && (
            <ShowQuestionScreen isImposter={currentPlayerIdx === imposterIdx} question={currentPlayerIdx === imposterIdx ? currentImposterQ : currentNormalQ} isLast={currentPlayerIdx + 1 === roundPlayerOrder.length} onDone={doneReading} blindImposter={settings.blindImposter} />
          )}
          {phase === PHASES.WRITE && (
            <WriteScreen onReady={startCountdown} />
          )}
          {phase === PHASES.COUNTDOWN && (
            <CountdownScreen countdown={countdown} />
          )}
          {phase === PHASES.SHOW_NAMES && (
            <ShowNamesScreen onReveal={() => setPhase(PHASES.REVEAL_QUESTION)} />
          )}
          {phase === PHASES.REVEAL_QUESTION && (
            <RevealQuestionScreen
              normalQuestion={currentNormalQ}
              onDone={() => setPhase(PHASES.RESULT)}
              timerEnabled={settings.timerEnabled}
              timerSeconds={settings.timerSeconds}
            />
          )}
          {phase === PHASES.RESULT && (
            <ResultScreen imposterName={roundPlayerOrder[imposterIdx]} normalQ={currentNormalQ} imposterQ={currentImposterQ} onFound={() => handleResult(true)} onNotFound={() => handleResult(false)} />
          )}
          {phase === PHASES.SCOREBOARD && (
            <ScoreboardScreen
              players={players}
              scores={scores}
              round={round}
              onPlayAgain={() => startGame()}
              onNewGame={startFreshGame}
              onReset={resetGame}
              targetEnabled={settings.targetEnabled}
              targetScore={settings.targetScore}
            />
          )}
        </React.Fragment>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<ImposterGame />);
  </script>
</body>
</html>
